<html>
  <head>
    <title>API - db - Kanso Framework</title>
    <link rel="stylesheet" href="http://yandex.st/highlightjs/5.16/styles/github.min.css">
    <link rel="stylesheet" href="../css/kanso.css" />
    <!--[if IE]>
      <link rel="stylesheet" href="../css/kanso_ie.css" />
    <![endif]-->
  </head>
  <body>
    <div id="topbar">
      <a id="logo" href="../index.html">
        <img src="../images/kanso_small.png" />
      </a>
      <a id="site" href="../index.html">Framework</a>
      <div id="rightmenu">
        <ul id="topmenu">
          <li>
            <a href="../index.html">About</a>
          </li>
          <li>
            <a href="../guides/index.html">Guides</a>
          </li>
          <li>
            <a href="../community.html">Community</a>
          </li>
          <li class="active">
            <a href="../api/index.html">API</a>
          </li>
          <li>
            <a href="https://github.com/caolan/kanso">Code</a>
          </li>
          <li>
            <a href="../download.html">Download</a>
          </li>
        </ul>
        <!--
        <ul id="sessionmenu">
          <li><a href="#">Create Account</a></li>
          <li><a href="#">Sign In</a></li>
        </ul>
        -->
      </div>
    </div>

    <div id="content">
      <h1>Kanso API Documentation</h1><p><a href="index.html">Index</a> | <a href="all.html">View on single page</a></p><div class="toc"><h2>Table of Contents</h2><ul><li><a href="#db">db</a><ul><li><a href="#db.encode">encode(str)</a></li><li><a href="#db.request">request(options, callback)</a></li><li><a href="#db.getRewrite">getRewrite(path, [q], callback)</a></li><li><a href="#db.getDoc">getDoc(id, [q, options], callback)</a></li><li><a href="#db.saveDoc">saveDoc(doc, [options], callback)</a></li><li><a href="#db.removeDoc">removeDoc(doc, [options], callback)</a></li><li><a href="#db.getView">getView(view, [q], callback)</a></li><li><a href="#db.getList">getList(list, view, [q], callback)</a></li><li><a href="#db.getShow">getShow(show, docid, [q], callback)</a></li><li><a href="#db.all">all([q], callback)</a></li><li><a href="#db.stringifyQuery">stringifyQuery(query)</a></li><li><a href="#db.newUUID">newUUID(cacheNum, callback)</a></li><li><a href="#db.createDatabase">createDatabase(name, callback)</a></li><li><a href="#db.deleteDatabase">deleteDatabase(name, callback)</a></li><li><a href="#db.getReplication">getReplication(id, callback)</a></li><li><a href="#db.startReplication">startReplication(options, callback)</a></li><li><a href="#db.waitReplication">waitReplication(doc, [options, state_function], callback)</a></li><li><a href="#db.stopReplication">stopReplication(doc, callback, [options])</a></li><li><a href="#db.deleteUser">deleteUser(username, callback)</a></li><li><a href="#db.getDesignDoc">getDesignDoc(name, callback, no_cache)</a></li></ul></li></ul></div><h2 id="db">db</h2><p>Contains functions for querying and storing data in CouchDB.</p><h3 id="db.encode">encode(str)</h3><p>Encodes a document id or view, list or show name.</p><h4>Parameters</h4><table class="params"><tr><td class="name">str</td><td class="type">String</td><td class="description"></td></tr></table><div class="returns"><strong>Returns: </strong><span class="type">String</span></div><h3 id="db.request">request(options, callback)</h3><p>Make a request, with some default settings and proper callback
handling. Used behind-the-scenes by most other DB module functions.</p><h4>Parameters</h4><table class="params"><tr><td class="name">options</td><td class="type">Object</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getRewrite">getRewrite(path, [q], callback)</h3><p>Fetches a rewrite from the database the app is running on. Results
are passed to the callback, with the first argument of the callback
reserved for any exceptions that occurred (node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">path</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getDoc">getDoc(id, [q, options], callback)</h3><p>Fetches a document from the database the app is running on. Results are
passed to the callback, with the first argument of the callback reserved
for any exceptions that occurred (node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">id</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">options</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.saveDoc">saveDoc(doc, [options], callback)</h3><p>Saves a document to the database the app is running on. Results are
passed to the callback, with the first argument of the callback reserved
for any exceptions that occurred (node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">doc</td><td class="type">Object</td><td class="description"></td></tr><tr><td class="name">options</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.removeDoc">removeDoc(doc, [options], callback)</h3><p>Deletes a document from the database the app is running on. Results are
passed to the callback, with the first argument of the callback reserved
for any exceptions that occurred (node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">doc</td><td class="type">Object</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getView">getView(view, [q], callback)</h3><p>Fetches a view from the database the app is running on. Results are
passed to the callback, with the first argument of the callback reserved
for any exceptions that occurred (node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">view</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getList">getList(list, view, [q], callback)</h3><p>Transforms and fetches a view through a list from the database the app
is running on. Results are passed to the callback, with the first
argument of the callback reserved for any exceptions that occurred
(node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">list</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">view</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getShow">getShow(show, docid, [q], callback)</h3><p>Transforms and fetches a document through a show from the database the app
is running on. Results are passed to the callback, with the first
argument of the callback reserved for any exceptions that occurred
(node.js style).</p><h4>Parameters</h4><table class="params"><tr><td class="name">show</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">docid</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.all">all([q], callback)</h3><p>Get all documents (including design docs).</p><h4>Parameters</h4><table class="params"><tr><td class="name">q</td><td class="type">Object</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.stringifyQuery">stringifyQuery(query)</h3><p>Properly encodes query parameters to CouchDB views etc. Handle complex
keys and other non-string parameters by passing through JSON.stringify.
Returns a shallow-copied clone of the original query after complex values
have been stringified.</p><h4>Parameters</h4><table class="params"><tr><td class="name">query</td><td class="type">Object</td><td class="description"></td></tr></table><div class="returns"><strong>Returns: </strong><span class="type">Object</span></div><h3 id="db.newUUID">newUUID(cacheNum, callback)</h3><p>Returns a new UUID generated by CouchDB. Its possible to cache
multiple UUIDs for later use, to avoid making too many requests.</p><h4>Parameters</h4><table class="params"><tr><td class="name">cacheNum</td><td class="type">Number</td><td class="description">(optional, default: 1)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.createDatabase">createDatabase(name, callback)</h3><p>Creates a CouchDB database.</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites for a PUT request to '/' and turn off safe rewrites.</p><h4>Parameters</h4><table class="params"><tr><td class="name">name</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.deleteDatabase">deleteDatabase(name, callback)</h3><p>Deletes a CouchDB database.</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites for a DELETE request to '/' and turn off safe rewrites.</p><h4>Parameters</h4><table class="params"><tr><td class="name">name</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getReplication">getReplication(id, callback)</h3><p>Fetches the most recent revision of the replication document
referred to by the id parameter.</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites to /_replicator, which will also mean turning
off safe rewrites.</p>

<p>This function only works with CouchDB >= 1.1, since it uses the
_replicator database.</p><h4>Parameters</h4><table class="params"><tr><td class="name">id</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.startReplication">startReplication(options, callback)</h3><p>Replicates options.source to options.target. The strings
options.source and options.target are each either a
CouchDB database name or a CouchDB database URI.</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites to /_replicator, which will also mean turning
off safe rewrites.</p>

<p>This function only works with CouchDB >= 1.1, since it uses the
_replicator database.</p><h4>Parameters</h4><table class="params"><tr><td class="name">options</td><td class="type">Object</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.waitReplication">waitReplication(doc, [options, state_function], callback)</h3><p>Waits for a replication operation to enter a specific state.
waitReplication polls the _replication database using the
doc provided, and evaluates state_function(doc) at each iteration.
This function stops polling and invokes callback when the
state_function evaluates to true. If state_function is not
provided, waitReplication waits for the doc's _replication_state
to change from 'triggered' to 'completed' (or 'error').</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites to /_replicator, which will also mean turning
off safe rewrites.</p>

<p>This function only works with CouchDB >= 1.1, since it uses the
_replicator database.</p><h4>Parameters</h4><table class="params"><tr><td class="name">doc</td><td class="type">Object</td><td class="description"></td></tr><tr><td class="name">state_function</td><td class="type">Function</td><td class="description">(optional)</td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.stopReplication">stopReplication(doc, callback, [options])</h3><p>Stops a replication operation already in progress.
The doc parameter can be obtained by calling getReplication.</p>

<p>If you're running behind a virtual host you'll need to set up
appropriate rewrites to /_replicator, which will also mean turning
off safe rewrites.</p>

<p>This function only works with CouchDB >= 1.1, since it uses the
_replicator database.</p><h4>Parameters</h4><table class="params"><tr><td class="name">id</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr><tr><td class="name">options</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.deleteUser">deleteUser(username, callback)</h3><p>Deletes an existing user document, given its username. You
must be logged in as an administrative user for this function
to succeed.</p><h4>Parameters</h4><table class="params"><tr><td class="name">username</td><td class="type">String</td><td class="description"></td></tr><tr><td class="name">callback</td><td class="type">Function</td><td class="description"></td></tr></table><h3 id="db.getDesignDoc">getDesignDoc(name, callback, no_cache)</h3><p>Fetch a design document from CouchDB. By default, the
results of this function are cached within the javascript
engine. To avoid this, pass true for the no_cache argument.</p><h4>Parameters</h4><table class="params"><tr><td class="name">name</td><td class="type"></td><td class="description">The name of (i.e. path to) the design document.</td></tr><tr><td class="name">callback</td><td class="type"></td><td class="description">The callback to invoke when the request completes.</td></tr><tr><td class="name">no_cache</td><td class="type"></td><td class="description">optional; true to force a cache miss for this request.</td></tr></table>
    </div>

    <script src="http://yandex.st/highlightjs/5.16/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20477836-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </body>
</html>
